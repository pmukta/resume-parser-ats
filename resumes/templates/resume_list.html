{% extends "base.html" %}
{% block title %}All Resumes{% endblock %}

{% block content %}
<div class="card">
  <div class="card-body">
    <h4>All Resumes</h4>
    <style>
    .delete-btn {
        background: #d9534f;
        color: white;
        padding: 6px 12px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 14px;
    }
    .delete-btn:hover {
        background: #c9302c;
    }
</style>
<form method="get" class="mb-3 d-flex gap-2">
    <input
        type="text"
        name="q"
        class="form-control"
        placeholder="Search by name, email, or skills..."
        value="{{ query }}"
    >
    <button class="btn btn-primary" type="submit">
        Search
    </button>

    {% if query %}
        <a href="{% url 'resumes:resume_list' %}" class="btn btn-outline-secondary">
            Clear
        </a>
    {% endif %}
</form>

{% if query %}
    <p class="text-muted">
        Showing results for "<strong>{{ query }}</strong>"
    </p>
{% endif %}

    {% if resumes %}
      <table class="table table-striped mt-3">
        <thead>
          <tr>
            <th>Name</th>
            <th>Email</th>
            <th>Mobile</th>
            <th>ATS Score</th>
            <th>Skills</th>
            <th>Date</th>
            <th>Action</th>
          </tr>
        </thead>

        <tbody>
          {% for resume in resumes %}
          <tr>
            <td>{{ resume.name }}</td>
            <td>{{ resume.email }}</td>
            <td>{{ resume.mobile }}</td>
            <td style="min-width:160px;">
              <div class="progress" style="height: 18px;">
                  <div class="progress-bar
                      {% if resume.ats_score >= 70 %}
                          bg-success
                      {% elif resume.ats_score >= 40 %}
                          bg-warning
                      {% else %}
                          bg-danger
                      {% endif %}"
                      role="progressbar"
                      style="width: {{ resume.ats_score }}%;">
                      {{ resume.ats_score }}%
                  </div>
              </div>
            </td>

            <td>{{ resume.skills }}</td>
            <td>{{ resume.created_at|date:"M d, Y" }}</td>

            <td>
              <a class="btn btn-info btn-sm" href="{% url 'resumes:view_resume' resume.id %}">View</a>
              <a class="btn btn-warning btn-sm" href="{% url 'resumes:edit_resume' resume.id %}">Edit</a>

              <form action="{% url 'resumes:delete_resume' resume.id %}" 
                    method="post" 
                    style="display:inline-block;"
                    onsubmit="return confirm('Are you sure you want to delete this resume?');">
                  {% csrf_token %}
                  <button type="submit" class="btn btn-danger btn-sm">Delete</button>
              </form>
            </td>

          </tr>
          {% endfor %}
        </tbody>

      </table>
    {% else %}
      <p class="text-muted">No resumes saved yet.</p>
    {% endif %}

  </div>
</div>
{% endblock %}
